<VirtualHost *:443>
    DocumentRoot "/var/www/html"
    ServerName tc.uc3m.es 

    SSLEngine on
    SSLCertificateFile "/etc/ssl/certs/server.crt"
    SSLCertificateKeyFile "/etc/ssl/private/server.key"
    SSLCertificateChainFile /etc/ssl/certs/ca.crt

    # Other directives here
</VirtualHost>

<VirtualHost *:9443>
    ServerName internal.tc.uc3m.es
    DocumentRoot "/var/www/internal"

    SSLEngine on
    SSLCertificateFile "/etc/ssl/certs/internal.crt"
    SSLCertificateKeyFile "/etc/ssl/private/internal.key"
    SSLCertificateChainFile "/etc/ssl/certs/ca.crt"

    # Other directives specific to the subdomain
</VirtualHost>

# ============================================================================
# GLOBAL SERVER CONFIGURATION
# ============================================================================
# Note: ServerTokens and ServerSignature cannot be inside <VirtualHost>
# They are global directives that apply server-wide

# Default values (can be overridden by specific VirtualHost needs)
ServerTokens Prod
ServerSignature Off

# ============================================================================
# NEW VIRTUALHOSTS FOR TESTING - Using cert1 through cert4
# ============================================================================

# ----------------------------------------------------------------------------
# VirtualHost 1: cert1 - BASELINE GOOD CONFIGURATION (Port 7001)
# ----------------------------------------------------------------------------
# Certificate: RSA 2048 bits, 180 days, signed by CA
# Expected alerts: NONE (this is the baseline "perfect" configuration)
# Purpose: Validate script doesn't generate false positives
<VirtualHost *:7001>
    ServerName secure.example.com
    DocumentRoot "/var/www/html"

    SSLEngine on
    SSLCertificateFile "/etc/ssl/my_certs/cert1-cert.pem"
    SSLCertificateKeyFile "/etc/ssl/my_certs/cert1-key.pem"
    SSLCertificateChainFile "/etc/ssl/my_certs/ca-cert.pem"

    # Strong TLS configuration - NO alerts expected
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
    SSLHonorCipherOrder on
    SSLCompression off

    # Enhanced: Strong DH parameters
    SSLOpenSSLConfCmd DHParameters /etc/ssl/my_certs/dhparams2048.pem

    # Enhanced: Recommended TLS curves
    SSLOpenSSLConfCmd Curves X25519:prime256v1:secp384r1

    # Enhanced: HSTS with recommended max-age
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"

    # Enhanced: Server version hiding is configured globally above
</VirtualHost>

# ----------------------------------------------------------------------------
# VirtualHost 2: cert2 - WEAK KEY + WEAK CIPHERS (Port 7002)
# ----------------------------------------------------------------------------
# Certificate: RSA 1024 bits (weak), signed by CA
# Expected alerts:
#   - HIGH: Weak certificate key (RSA 1024 bits < 2048)
#   - HIGH: Unsupported cipher suites
#   - CRITICAL: CBC and/or SHA-1 in cipher suite
#   - ENHANCED HIGH: No HSTS header
#   - ENHANCED HIGH: DH parameter size < 2048
#   - ENHANCED LOW: Client cipher preference
# Note: TLS 1.0/1.1 removed as they're not supported by modern OpenSSL
<VirtualHost *:7002>
    ServerName weak.example.com
    DocumentRoot "/var/www/html"

    SSLEngine on
    SSLCertificateFile "/etc/ssl/my_certs/cert2-cert.pem"
    SSLCertificateKeyFile "/etc/ssl/my_certs/cert2-key.pem"
    SSLCertificateChainFile "/etc/ssl/my_certs/ca-cert.pem"

    # Weak TLS configuration - Multiple alerts expected
    # Using TLS 1.2 only (no 1.3) with weak ciphers
    SSLProtocol -all +TLSv1.2
    SSLCipherSuite AES128-SHA:AES256-SHA:AES128-SHA256:AES256-SHA256
    SSLHonorCipherOrder off
    SSLCompression off

    # Enhanced: Weak DH parameters
    SSLOpenSSLConfCmd DHParameters /etc/ssl/my_certs/dhparams1024.pem

    # Enhanced: No HSTS header (intentionally omitted)
    # Enhanced: Server disclosure (default ServerTokens)
</VirtualHost>

# ----------------------------------------------------------------------------
# VirtualHost 3: cert3 - SELF-SIGNED + MISCONFIGURATIONS (Port 7003)
# ----------------------------------------------------------------------------
# Certificate: Self-signed, RSA 2048, CN=192.168.1.100 (IP address)
#              SAN includes non-qualified hostname "server" and IP
# Expected alerts:
#   - CRITICAL: Self-signed certificate detected
#   - CRITICAL: CBC and/or SHA-1 in cipher suite
#   - MEDIUM: Domain name mismatch (if accessed via different hostname)
#   - LOW: IP address in certificate CN
#   - LOW: IP address in certificate SAN
#   - LOW: Non-qualified hostname in SAN
#   - ENHANCED LOW: CN and SAN attributes not aligned
#   - ENHANCED MEDIUM: HSTS max-age too low
#   - ENHANCED MEDIUM: Server information disclosure
<VirtualHost *:7003>
    ServerName server
    DocumentRoot "/var/www/html"

    SSLEngine on
    SSLCertificateFile "/etc/ssl/my_certs/cert3-cert.pem"
    SSLCertificateKeyFile "/etc/ssl/my_certs/cert3-key.pem"
    # No SSLCertificateChainFile - self-signed certificate

    # Mixed configuration - TLS 1.2 but weak ciphers
    SSLProtocol -all +TLSv1.2
    SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:AES128-SHA:AES256-SHA
    SSLHonorCipherOrder on
    SSLCompression off

    # Enhanced: HSTS with low max-age (31536000 = 1 year, recommended is 2 years)
    Header always set Strict-Transport-Security "max-age=31536000"

    # Enhanced: Server disclosure - Note: ServerTokens/ServerSignature are global
    # This VirtualHost intentionally demonstrates weak security (would use Full/On if allowed)
</VirtualHost>

# ----------------------------------------------------------------------------
# VirtualHost 4: cert4 - WILDCARD + UNSUPPORTED CURVE (Port 7004)
# ----------------------------------------------------------------------------
# Certificate: ECDSA P-256, wildcard *.example.org, signed by CA
# Expected alerts:
#   - ENHANCED LOW: Wildcard certificate detected in CN/SAN
#   - ENHANCED HIGH: Unsupported TLS curve (secp521r1)
#   - ENHANCED LOW: Client cipher preference honored
# Purpose: Test enhanced functionalities (wildcard, curves, cipher preference)
<VirtualHost *:7004>
    ServerName wildcard.example.org
    DocumentRoot "/var/www/html"

    SSLEngine on
    SSLCertificateFile "/etc/ssl/my_certs/cert4-cert.pem"
    SSLCertificateKeyFile "/etc/ssl/my_certs/cert4-key.pem"
    SSLCertificateChainFile "/etc/ssl/my_certs/ca-cert.pem"

    # Strong protocols but with configuration issues
    SSLProtocol -all +TLSv1.2 +TLSv1.3
    SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384
    
    # Enhanced: Client cipher preference (intentionally weak)
    SSLHonorCipherOrder off
    
    SSLCompression off

    # Enhanced: Unsupported TLS curve (secp521r1 not in recommended list)
    SSLOpenSSLConfCmd Curves secp521r1:prime256v1

    # Enhanced: Strong DH parameters
    SSLOpenSSLConfCmd DHParameters /etc/ssl/my_certs/dhparams2048.pem

    # Enhanced: HSTS configured properly
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"

    # Enhanced: Server version hiding is configured globally above
</VirtualHost>
